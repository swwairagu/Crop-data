---
title: "Cotton Data Analysis"
author: "Stephanie Wairagu"
date: '2/1/2023'
output: 
  html_document: 
    theme: cerulean
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Objective

The aim of this research project is to investigate the effect of **iQFORTE**, a plant-based amino acid biostimulant, on cotton. We do this by exploring and analyzing cotton data provided by Matthew Starr of the Department of Crop and Soil Sciences at North Carolina State University.

## Background

A plant biostimulant is any substance or microorganism applied to plants that fosters plant growth and development throughout the crop life cycle from seed germination to planting maturity. Biostimulants achieve this in a number of demonstrated ways such as:

- Improving the efficiency of the plant's metabolism to induce yield increases and enhanced crop quality

- Increasing plant tolerance to and recovery from abiotic stresses

- Facilitating nutrient assimilation, translocation, and use

- Enhancing quality attributes of products, including sugar content, color, fruit seeding, etc.

- Rendering water use more efficient

- Enhancing soil fertility, particularly by fostering the development of complementary soil microorganisms

Plant-based protein hydrolysates (PHs) like iQFORTE have increased in popularity because of their potential to increase the germination, productivity and quality of a wide range of horticultural and agronomic crops. iQFORTE contains oligopeptides and free amino acids as active materials and specifically works to:

- Strengthen the root system

- Enhance nutrients uptake, transport, and mobilization of minerals

- Stimulate the vegetative growth

- Enhance uniformity of flowering and fruiting

- Improve the quality parameters of fruits

- Prepare the plant against stress conditions

## Getting Started

We'll use the **tidyverse** package for this analysis. If not previously installed, you can do so by running the following *install.packages* command in the console:

```{r install-package, eval=FALSE}
install.packages("tidyverse")
```

Next, run the following *library* command to load the tidyverse package:

```{r load-package, message=FALSE, eval=TRUE}
library(tidyverse)
```

## Data

We can now read in our data set using the following command:

```{r load-data, message=FALSE, eval=TRUE}
cotton_data <- read_csv("data/cotton-data.csv")
```

To view the data in the data viewer, run `view(cotton_data)` in the console. This will pop open a separate window with the data.

This data set has `r nrow(cotton_data)` rows and `r ncol(cotton_data)` columns. Each row represents a unique cotton plant, treatment observation. Each column represents a variable. To get a list of the variables in the data frame, we can use the `names()` function:

```{r variable-names}
names(cotton_data)
```

I'll rename the variables for consistency and to minimize the possibility of errors when using the variable names:

```{r rename-variables}
cotton <- cotton_data %>% 
  rename(
    OpenBollWeight_g = `Open Boll Weight (g)`,
    OpenBollsperPlant = `Open Bolls per Plant`,
    SeedWeight_g = `Seed Weight (g)`,
    LintWeight_g = `Lint Weight (g)`,
    Log_OpenBollWeight = `Log-OpenBollWeight`,
    Log_OpenBollsperPlant = `Log-OpenBollsperPlant`,
    Log_SeedWeight = `Log-SeedWeight`,
    Log_LintWeight = `Log-LintWeight`
    )
```

#### New variable names

```{r new-var-names}
names(cotton)
```

## Exploratory Data Analysis

### Response: Lint Weight

We first examine the distribution of the lint weight of cotton plants in both the IQ and control groups:

```{r hist-lintwt, fig.height=5, fig.width=9}
ggplot(cotton, aes(x = LintWeight_g,                # add the data and specify x-axis
                   fill = Treatment)) +             # fill color based on treatment group
  geom_histogram(bins = 14) +                       # set appropriate histogram bin size                     
  labs(x = "Lint Weight (g)",                       # x-axis label                         
       y = "Frequency",                             # y-axis label                            
       title = "Distribution of Lint Weight",       # graph title       
       subtitle = "By Treatment Group") +           # graph subtitle                
  facet_wrap(~ Treatment) +                         # creates panes based on treatment group                             
  theme(legend.position = "none")                   # removes legend
```

```{r n-treatment}
# Check sample sizes by treatment group
cotton %>%
  count(Treatment)
```

After examining the distribution of the lint weight for the control and IQ groups, it was found that the distribution for the IQ treatment group is *right-skewed* and the sample size is only 20 (not large enough for the Central Limit Theorem to take effect if using a t-test to compare the means of the two groups). To address the non-normality of the IQ treatment group, the natural log of each observation was taken in both treatment groups. The distribution of the log was then examined in each group, and a Shapiro-Wilk test for normality was conducted (where the null hypothesis is the data are normal).

##### Log distribution

```{r hist-log-lintwt, fig.height=5, fig.width=9}
ggplot(cotton, aes(x = Log_LintWeight,
                   fill = Treatment)) +
  geom_histogram(bins = 13) +                         
  labs(x = "Log Lint Weight",                             
       y = "Frequency",                                   
       title = "Distribution of the Log of Lint Weight",         
       subtitle = "By Treatment Group") +                      
  facet_wrap(~ Treatment) +                                    
  theme(legend.position = "none")
```

##### Shapiro-Wilk Normality Test

```{r shap-wilk-control-log-lintwt}
control_cotton_filtered <- cotton %>%                           # create a data frame with only the controls  
  filter(Treatment == "Control")                                # filter

shapiro.test(control_cotton_filtered$Log_LintWeight)            # Shapiro-Wilk normality test
```

```{r shap-wilk-IQ-log-lintwt}
IQ_cotton_filtered <- cotton %>%                                # create a data frame with IQ observations only 
  filter(Treatment == "IQ")                                     # filter

shapiro.test(IQ_cotton_filtered$Log_LintWeight)                 # Shapiro-Wilk normality test
```

Taking a log transformation did help, but the distribution of the control group is starting to look left skewed after doing the log transformation. The p-value for the Shapiro-Wilk test for the control group is 0.0562 and 0.995 for the IQ group, so technically we fail to reject that the data are normal at the 0.05 level of significance. However, I am still not comfortable with how left-skewed the control group looks after the log transformation, so doing the Wilcoxon nonparametric test is preferable.

The Wilcoxon rank sum test is a non-parametric alternative to the independent two samples t-test for comparing two independent groups, in the situation where the data are not normally distributed. It is also based on ranks, so it is resistant to outliers. In a Wilcoxon rank sum test, the null hypothesis is that the two groups being compared come from the same population, and the alternative hypothesis is that the two groups come from different populations.

##### Wilcoxon Rank Sum Test

To perform the Wilcoxon rank sum test, we will use the **rstatix** package. If not previously installed, you can do so by running the following *install.packages* command in the console:

```{r eval=FALSE}
install.packages("rstatix")
```

We then load rstatix package: 

```{r warning=FALSE, message=FALSE, eval=TRUE}
library(rstatix)
```

We can now perform the Wilcoxon Rank Sum test: 

```{r wilcox-lintwt}
cotton %>% 
  wilcox_test(LintWeight_g ~ Treatment)
```

The p-value of the Wilcoxon Rank Sum test is 0.0103, indicating significant evidence to reject the null hypothesis of the two groups coming from the same population. Therefore, we can conclude that the location of the two distributions differs significantly. Specifically, in the context of comparing lint weight between two groups, we can interpret the result as suggesting a difference in median lint weight between the groups.

#### Visualization

```{r box-lintwt, fig.height=7, fig.width=9}
ggplot(cotton, aes(x = Treatment,
                   y = LintWeight_g,
                   fill = Treatment)) +
  geom_boxplot() +
  labs(x = "Treatment",
       y = "Lint Weight (g)",
       title = "Distribution of Lint Weight by Treatment") +
  theme(legend.position = "none")
```

## Functions

Since the steps in this analysis are repeated across different variables, writing functions is more efficient:

```{r function-histogram}
distribution <- function(data, col){
  data %>% 
    ggplot(aes(x = .data[[col]],
               fill = Treatment)) +
    geom_histogram(bins = 15) +
    labs(x = col, y = "Frequency", title = "Distribution", subtitle = "By Treatment Group") +
    facet_wrap(~ Treatment) +
    theme(legend.position = "none")
}
```

```{r function-shapiro}
shapiro <- function(data, col){
  result <- shapiro.test(data[[col]])
  return(result)
}
```

```{r function-qqplot, warning=FALSE, message=FALSE, eval=TRUE}
library(qqplotr)
qqplot <- function(data, col){
  ggplot(data, aes(sample = .data[[col]])) +
  stat_qq_point(size = 2) +
  stat_qq_line(col = "orange") +
  labs(x = "Theoretical Quantiles",
       y = "Sample Quantiles" ,
       title = "Normal Quantile Plot")
}
```

```{r function-test}
# Perform t-test or Wilcoxon Rank sum test based on Shapiro-Wilk test result
test <- function(data1, data2, col){
  
  result1 <- shapiro.test(data1[[col]])
  result2 <- shapiro.test(data2[[col]])
  
  if (result1$p.value > 0.05 & result2$p.value > 0.05) {
    t_test <- t.test(data1[[col]], data2[[col]], var.equal=TRUE)  
    print(t_test)
  }
  else {
    wilcox <- wilcox_test(as.formula(paste(col, "~ Treatment")), data = rbind(data1, data2))     
    return(wilcox)
  }
}
```

### Response: Open Boll Weight

```{r openbollwt}
distribution(cotton, col = "OpenBollWeight_g")
shapiro(control_cotton_filtered, col = "OpenBollWeight_g" )
shapiro(IQ_cotton_filtered, col = "OpenBollWeight_g")
qqplot(control_cotton_filtered, col = "OpenBollWeight_g")
qqplot(IQ_cotton_filtered, col = "OpenBollWeight_g")
test(control_cotton_filtered, IQ_cotton_filtered, col = "OpenBollWeight_g")
```

The p-value for the Wilcoxon Rank Sum test is 0.035. Therefore we can conclude that the location of the two distributions differs significantly, and that there is a significant difference in the median open boll weight between the IQ and control groups.

#### Visualization

```{r box-openbollwt, fig.height=7, fig.width=9}
ggplot(cotton, aes(x = Treatment,
                   y = OpenBollWeight_g,
                   fill = Treatment)) +
  geom_boxplot() +
  labs(x = "Treatment",
       y = "Open Boll Weight (g)",
       title = "Distribution of Open Boll Weight by Treatment") +
  theme(legend.position = "none")
```

### Response: Open Bolls per Plant

```{r openbollsperplant}
distribution(cotton, col = "OpenBollsperPlant")
shapiro(control_cotton_filtered, col = "OpenBollsperPlant" )
shapiro(IQ_cotton_filtered, col = "OpenBollsperPlant")
qqplot(control_cotton_filtered, col = "OpenBollsperPlant")
qqplot(IQ_cotton_filtered, col = "OpenBollsperPlant")
test(control_cotton_filtered, IQ_cotton_filtered, col = "OpenBollsperPlant")
```

The p-value for the Wilcoxon Rank Sum test is 0.026. Therefore we can conclude that the location of the two distributions differs significantly, and that there is a significant difference in the median number of open bolls per plant between the IQ and control groups.

#### Visualization

```{r box-openbollspp, fig.height=7, fig.width=9}
ggplot(cotton, aes(x = Treatment,
                   y = OpenBollsperPlant,
                   fill = Treatment)) +
  geom_boxplot() +
  labs(x = "Treatment",
       y = "Open Bolls per Plant",
       title = "Distribution of Number of Open Bolls per Plant by Treatment") +
  theme(legend.position = "none")
```

### Response: Seed Weight

```{r seedwt}
distribution(cotton, col = "SeedWeight_g")
shapiro(control_cotton_filtered, col = "SeedWeight_g" )
shapiro(IQ_cotton_filtered, col = "SeedWeight_g")
qqplot(control_cotton_filtered, col = "SeedWeight_g")
qqplot(IQ_cotton_filtered, col = "SeedWeight_g")
test(control_cotton_filtered, IQ_cotton_filtered, col = "SeedWeight_g")
```

The p-value for the Wilcoxon Rank Sum test is 0.0155. Therefore we can conclude that the location of the two distributions differs significantly, and that there is a significant difference in the median seed weight between the IQ and control groups.

#### Visualization

```{r box-seedwt, fig.height=7, fig.width=9}
ggplot(cotton, aes(x = Treatment,
                   y = SeedWeight_g,
                   fill = Treatment)) +
  geom_boxplot() +
  labs(x = "Treatment",
       y = "Seed Weight (g)",
       title = "Distribution of Seed Weight by Treatment") +
  theme(legend.position = "none")
```

## Lint Quality Data 

First, we read in the cotton lint quality data:

```{r lint-data, message=FALSE, eval=TRUE}
lint_data <- read.csv("data/lint-quality-data.csv")
```

This dataset has `r nrow(lint_data)` rows and `r ncol(lint_data)` columns. Each row represents a unique cotton plant, treatment observation. Each column represents a variable. To get a list of the variables in the data frame, we use the `names()` function:

```{r lint-var}
names(lint_data)
```
I will rename the "Uniformity.Index" variable for consistency with variable naming:

```{r}
lint_data <- lint_data %>% 
  rename(UniformityIndex = "Uniformity.Index")

names(lint_data)
```
##### Filtering Data by Treatment Groups

```{r filter-lint}
control_lint_data <- lint_data %>%
  filter(Treatment == "Control")  
IQ_lint_data <- lint_data %>%                               
  filter(Treatment == "IQ")  
```

### Response: Length (UHML)

```{r length}
distribution(lint_data, col = "UHML")
shapiro(control_lint_data, col = "UHML" )
shapiro(IQ_lint_data, col = "UHML")
qqplot(control_lint_data, col = "UHML")
qqplot(IQ_lint_data, col = "UHML")
test(control_lint_data, IQ_lint_data, col = "UHML")
```

### Response: Strength

```{r strength}
distribution(lint_data, col = "Strength")
shapiro(control_lint_data, col = "Strength" )
shapiro(IQ_lint_data, col = "Strength")
qqplot(control_lint_data, col = "Strength")
qqplot(IQ_lint_data, col = "Strength")
test(control_lint_data, IQ_lint_data, col = "Strength")
```

### Response: Micronaire

```{r micronaire}
distribution(lint_data, col = "Micronaire")
shapiro(control_lint_data, col = "Micronaire" )
shapiro(IQ_lint_data, col = "Micronaire")
qqplot(control_lint_data, col = "Micronaire")
qqplot(IQ_lint_data, col = "Micronaire")
test(control_lint_data, IQ_lint_data, col = "Micronaire")
```

### Response: Uniformity Index

```{r UI}
distribution(lint_data, col = "UniformityIndex")
shapiro(control_lint_data, col = "UniformityIndex" )
shapiro(IQ_lint_data, col = "UniformityIndex")
qqplot(control_lint_data, col = "UniformityIndex")
qqplot(IQ_lint_data, col = "UniformityIndex")
test(control_lint_data, IQ_lint_data, col = "UniformityIndex")
```




























