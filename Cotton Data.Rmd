---
title: "Cotton Data Analysis"
author: "Stephanie Wairagu"
date: '2/1/2023'
output: 
  html_document: 
    theme: cerulean
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Background

The aim of this research project is to explore and analyze cotton data provided by Matthew Starr of the Department of Crop and Soil Sciences at North Carolina State University to understand the effect of **iQFORTE**, a plant-based amino acid biostimulant on cotton. 


A plant biostimulant is any substance or microorganism applied to plants that fosters plant growth and development throughout the crop life cycle from seed germination to planting maturity. Biostimulants achieve this in a number of demonstrated ways such as:

- Improving the efficiency of the plant's metabolism to induce yield increases and enhanced crop quality

- Increasing plant tolerance to and recovery from abiotic stresses

- Facilitating nutrient assimilation, translocation, and use

- Enhancing quality attributes of products, including sugar content, color, fruit seeding, etc.

- Rendering water use more efficient

- Enhancing soil fertility, particularly by fostering the development of complementary soil microorganisms

Plant-based protein hydrolysates (PHs) like iQFORTE have increased in popularity because of their potential to increase the germination, productivity and quality of a wide range of horticultural and agronomic crops. iQFORTE specifically is a natural extract whose active materials are oligopeptides and free amino acids obtained by enzymatic hydrolysis from highly energetic seeds that works to:

- Strengthen the root system

- Enhance nutrients uptake, transport, and mobilization of minerals

- Stimulate the vegetative growth

- Enhance uniformity of flowering and fruiting

- Improve the quality parameters of fruits

- Prepare the plant against stress conditions


## Getting Started

We'll use the **tidyverse** package for this analysis. If not previously installed, you can do so by running the following *install.packages* command in the console:

```{r install-package, eval=FALSE}
#install.packages("tidyverse")
```

Next, run the following *library* command to load the tidyverse package:

```{r load-package, message=FALSE, eval=TRUE}
library(tidyverse)
```


## Data

We can now read in our dataset using the following command:

```{r load-data, message=FALSE, eval=TRUE}
cotton_data <- read.csv("data/cotton-data.csv")
```


To view the data in the data viewer, run `View(cotton_data)` in the console. This will pop open a separate window with the data.


This dataset has `r nrow(cotton_data)` rows and `r ncol(cotton_data)` columns.

Each row represents a unique cotton plant, treatment observation. \
Each column represents a variable. To get a list of the variables in the data frame, we can use the `names()` function:
```{r variable-names}
names(cotton_data)
```


We'll now create a new data frame with the same variables though some have been renamed for consistency:

```{r rename-variables}
cotton <- cotton_data %>% 
  rename(
    OpenBollWeight_g = Open.Boll.Weight..g.,
    OpenBollsperPlant = Open.Bolls.per.Plant,
    SeedWeight_g = Seed.Weight..g.,
    LintWeight_g = Lint.Weight..g.
    )
```

#### New variable names

```{r new-var-names}
names(cotton)
```


# Exploratory Data Analysis

## Response: Open Boll Weight

We first create a visualization for the distribution of the **open boll weight** of cotton plants in both the control and treatment groups: 

```{r hist-openbollweight, fig.height=6, fig.width=10}
ggplot(cotton, aes(x = OpenBollWeight_g ,                      # add the data and specify x-axis
                        fill = Treatment)) +                   # fill color based on treatment group
  geom_histogram(bins = 15) +                                  # set appropriate histogram bin size 
  labs(x = "Open boll weight (g)",                             # x-axis label
       y = "Frequency",                                        # y-axis label
       title = "Distribution of the Open Boll Weight",         # title of the graph
       subtitle = "By Treatment Group") +                      # graph subtitle
  facet_wrap(~ Treatment) +                                    # creates panes based on treatment group
  theme(legend.position = "none")                              # removes legend
```

```{r n-treatment}
# Check sample sizes by treatment group
cotton %>%
  count(Treatment)
```


After examining the distribution of the open boll weight for the control and treatments groups, it was found that the distribution for the iQFORTE treatment group is *right-skewed* and the sample size is only 20 (not large enough for the Central Limit Theorem to take effect if using a t-test to compare the means of the two groups).


To address the non-normality of the treatment group, the natural log of each observation was taken in both groups, and the distribution of the log of each group was examined and a Shapiro-Wilk test for normality was conducted (where the null hypothesis is the data are normal).


##### Shapiro-Wilk Normality Tests

```{r shapiro-wilk-control}
control_data_filtered <- cotton %>%                             # create a data frame with only the controls  
  filter(Treatment == "Control")                                # filter 
shapiro.test(control_data_filtered$Log.OpenBollWeight)          # Shapiro-Wilk normality test
```

```{r shapiro-wilk-IQ}
IQ_data_filtered <- cotton %>%                                  # create a data frame with IQ observations only 
  filter(Treatment == "IQ")                                     # filter 
shapiro.test(IQ_data_filtered$Log.OpenBollWeight)               # Shapiro-Wilk normality test
```

For the control group, the p-value for the Shapiro-Wilk test was 0.2255 and for the IQ treatment group it was 0.7194. So we donâ€™t have enough evidence to suggest the data are not normal, and we fail to reject the null hypothesis. It appears the log transformation has helped. The normal quantile plot for each group also seems to confirm this.


##### Normal Quantile Plots

To create the normal quantile plots, we will use the **qqplotr** package. If not previously installed, you can do so by running the following *install.packages* command in the console:

```{r eval=FALSE}
#install.packages("qqplotr")
```

Load the qqplotr package:

```{r message=FALSE, eval=TRUE}
library(qqplotr)
```

We can now create our normal quantile plots:

```{r Q-Q-control}
ggplot(control_data_filtered, aes(sample = Log.OpenBollWeight)) +
  stat_qq_point(size = 2) +
  stat_qq_line() +
  stat_qq_band(alpha = 0.5) +
  labs(x = "Theoretical Quantiles" ,
       y = "Sample Quantiles" ,
       title = "Control Group Normal Quantile Plot")
```

```{r Q-Q-IQ}
ggplot(IQ_data_filtered, aes(sample = Log.OpenBollWeight)) +
  stat_qq_point(size = 2) +
  stat_qq_line() +
  stat_qq_band(alpha = 0.5) +
  labs(x = "Theoretical Quantiles" ,
       y = "Sample Quantiles" ,
       title = " IQ Group Normal Quantile Plot")
```

Both of the normal quantile plots show that the log transformed data in the two groups are normal.


##### Two-sided t-test

We then do a t-test to compare the difference of the means for the two groups using the log transformed observations. For a 2-sided test, the p-value is 0.0142, which suggests that at a significance level of 0.05, we have evidence to suggest the means of the two groups are different. 

```{r t-test}
control_log_openbollwt <- control_data_filtered %>%                 # create a data frame with observations from control group
  select(Log.OpenBollWeight)
IQ_log_openbollwt <- IQ_data_filtered %>%                           # create a data frame with observations from IQ group
  select(Log.OpenBollWeight)
t.test(control_log_openbollwt, IQ_log_openbollwt, var.equal=TRUE)   # two-sided t-test
```

#### Visualization

Below are side-by-side box plots visualizing the relationship between open boll weight and the treatment group:

```{r box-openbollwt, fig.height=7, fig.width=9}
ggplot(cotton, aes(x = Treatment,
                   y = OpenBollWeight_g,
                   fill = Treatment)) +
  geom_boxplot() +
  labs(x = "Treatment",
       y = "Open Boll Weight (g)",
       title = "Open Boll Weight (g) vs. Treatment") +
  theme(legend.position = "none")
```


## Response: Open Bolls per Plant

Below are the distributions for each treatment group. The distribution for the treatment group is right skewed, and the sample size is too small to assume Central Limit Theorem will take effect.

```{r hsit-openbolls, fig.height=6, fig.width=10}
ggplot(cotton, aes(x = OpenBollsperPlant,
                   fill = Treatment)) +
  geom_histogram(bins = 12) +                         
  labs(x = "Open Bolls per Plant",                             
       y = "Frequency",                                   
       title = "Distribution of Open Bolls per Plant",         
       subtitle = "By Treatment Group") +                      
  facet_wrap(~ Treatment) +                                    
  theme(legend.position = "none") 
```
















